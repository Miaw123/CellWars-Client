!function(){"use strict";var e=(function(){function e(e){this.value=e}function t(t){function i(e,t){return new Promise(function(i,s){var r={key:e,arg:t,resolve:i,reject:s,next:null};a?a=a.next=r:(o=a=r,n(e,t))})}function n(i,o){try{var a=t[i](o),r=a.value;r instanceof e?Promise.resolve(r.value).then(function(e){n("next",e)},function(e){n("throw",e)}):s(a.done?"return":"normal",a.value)}catch(e){s("throw",e)}}function s(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}o=o.next,o?n(o.key,o.arg):a=null}var o,a;this._invoke=i,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),i=function(){function i(){e(this,i)}return t(i,null,[{key:"init",value:function(e){this._offset=0,this._buffer=Buffer.from(e)}},{key:"readUInt8",value:function(){var e=this._buffer.readUInt8(this._offset);return this._offset+=1,e}},{key:"readInt8",value:function(){var e=this._buffer.readInt8(this._offset);return this._offset+=1,e}},{key:"readUInt16",value:function(){var e=this._buffer.readUInt16LE(this._offset);return this._offset+=2,e}},{key:"readInt16",value:function(){var e=this._buffer.readInt16LE(this._offset);return this._offset+=2,e}},{key:"readUInt32",value:function(){var e=this._buffer.readUInt32LE(this._offset);return this._offset+=4,e}},{key:"readInt32",value:function(){var e=this._buffer.readInt32LE(this._offset);return this._offset+=4,e}},{key:"readFloat",value:function(){var e=this._buffer.readFloatLE(this._offset);return this._offset+=4,e}},{key:"readDouble",value:function(){var e=this._buffer.readDoubleLE(this._offset);return this._offset+=8,e}},{key:"readBytes",value:function(e){return this._buffer.slice(this._offset,this._offset+e)}},{key:"skipBytes",value:function(e){this._offset+=e}},{key:"readStringUtf8",value:function(e){null==e&&(e=this._buffer.length-this._offset),e=Math.max(0,e);var t=this._buffer.toString("utf8",this._offset,this._offset+e);return this._offset+=e,t}},{key:"readStringUnicode",value:function(e){null==e&&(e=this._buffer.length-this._offset),e=Math.max(0,e);var t=e-e%2;t=Math.max(0,t);var i=this._buffer.toString("ucs2",this._offset,this._offset+t);return this._offset+=e,i}},{key:"readStringZeroUtf8",value:function(){for(var e=0,t=0,i=this._offset;i<this._buffer.length;i++){if(0===this._buffer.readUInt8(i)){t=1;break}e++}var n=this.readStringUtf8(e);return this._offset+=t,n}},{key:"readStringZeroUnicode",value:function(){for(var e=0,t=0!=(this._buffer.length-this._offset&1)?1:0,i=this._offset;i+1<this._buffer.length;i+=2){if(0===this._buffer.readUInt16LE(i)){t=2;break}e+=2}var n=this.readStringUnicode(e);return this._offset+=t,n}}]),i}(),n=function(){function i(t,n,s,o){e(this,i),this.value="",this.color=n||"#000000",this.stroke=s||!1,this.strokeColor=o||"#000000",this.size=t||16,this.canvas=null,this.ctx=null,this.dirty=!1,this.scale=1}return t(i,[{key:"setSize",value:function(e){this.size!==e&&(this.size=e,this.dirty=!0)}},{key:"setScale",value:function(e){this.scale!==e&&(this.scale=e,this.dirty=!0)}},{key:"setStrokeColor",value:function(e){this.strokeColor!==e&&(this.strokeColor=e,this.dirty=!0)}},{key:"setValue",value:function(e){var t=void 0;isNaN(e)||isNaN(this.value)||0===this.value||0===e||this.value===e||Math.abs((e-this.value)/this.value)<.012&&(t=this.value,this.value=e),e!==this.value&&(this.value=e,this.dirty=!0),t&&(this.value=t)}},{key:"render",value:function(){if(null==this.canvas&&(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")),this.dirty){this.dirty=!1;var e=this.canvas,t=this.ctx,i=this.value,n=this.scale,s=this.size,o=s+"px Roboto Mono";t.font=o;var a=~~(.2*s);e.width=(t.measureText(i).width+6)*n,e.height=(s+a)*n,t.font=o,t.scale(n,n),t.globalAlpha=1,t.lineWidth=3,t.strokeStyle=this.strokeColor,t.fillStyle=this.color,this.stroke&&t.strokeText(i,3,s-a/2),t.fillText(i,3,s-a/2)}return this.canvas}}]),i}(),s=function(){function i(t,n,s,o,a,r,l){e(this,i),this.id=t,this.position={x:n,y:s,r:o},this.animated={x:n,y:s,r:o},this.color=a,this.name=r,this.type=l,this.nameCache=null,this.sizeCache=null,this.setNameCache(r)}return t(i,[{key:"getNameSize",value:function(){return Math.max(~~(.3*this.animated.r),24)}},{key:"setNameCache",value:function(e){null===this.nameCache?(this.nameCache=new n(this.getNameSize(),"#FFFFFF",!0,"#000000"),this.nameCache.setValue(this.name)):(this.nameCache.setSize(this.getNameSize()),this.nameCache.setValue(this.name))}}]),i}(),o=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){this.cells=[],this.food=[],this.border={top:-7071,bottom:7071,left:-7071,right:7071}}},{key:"addCell",value:function(e){var t=new s(e.id,e.x,e.y,e.r,e.color,e.name,e.type);3!==e.type?this.cells[e.id]=t:this.food[e.id]=t,1===e.type&&c.cellIds.indexOf(e.id)>-1&&(c.cells[e.id]=t,c.isSpawned=!0)}},{key:"removeCell",value:function(e){3!==e.type?(e.id in this.cells&&(this.cells[e.id]=null,delete this.cells[e.id]),e.id in c.cells&&(c.cells[e.id]=null,delete c.cells[e.id])):(this.food[e.id]=null,delete this.food[e.id])}},{key:"updateCell",value:function(e){3!==e.type?e.id in this.cells&&(this.cells[e.id].position.x=e.x,this.cells[e.id].position.y=e.y,this.cells[e.id].position.r!==e.r&&(this.cells[e.id].position.r=e.r,this.sortCells())):(this.food[e.id].position.x=e.x,this.food[e.id].position.y=e.y)}},{key:"sortCells",value:function(){}}]),i}(),a=function(){function n(){e(this,n)}return t(n,null,[{key:"handle",value:function(e){var t=this;this.packets||(this.packets={100:function(){return t.handshake()}}),i.init(e);var n=i.readUInt8();n in this.packets&&this.packets[n]()}},{key:"handshake",value:function(){var e=this;57===i.readUInt8()&&(Logger.success("Handshake received"),this.packets={110:function(){return e.reset()},120:function(){return e.border()},130:function(){return e.playerCellId()},140:function(){return e.leaderboard()},150:function(){return e.cells()}})}},{key:"reset",value:function(){o.cells=[],o.food=[],c.cells=[],c.cellIds=[],Logger.success("Cells cleared")}},{key:"border",value:function(){var e={top:i.readDouble(),bottom:i.readDouble(),left:i.readDouble(),right:i.readDouble()};o.border=e,Logger.success("Border received")}},{key:"playerCellId",value:function(){var e=i.readUInt32();c.addCellId(e),Logger.success("Player cell received")}},{key:"leaderboard",value:function(){for(var e="",t=i.readUInt8(),n=0;n<t;n++){var s=i.readStringZeroUtf8();e+='<span class="'+(i.readUInt8()?"lbHighlight":"")+'">'+(n+1)+". "+s+"</span>"}f.leaderboard.html(e)}},{key:"cells",value:function(){c.isAlive&&(this.eatenCells(),this.removeCells(),this.addCells(),this.updateCells())}},{key:"eatenCells",value:function(){for(var e={},t=i.readUInt16();t--;)e.type=i.readUInt8(),e.id=i.readUInt32(),e.hunterId=i.readUInt32(),o.removeCell(e)}},{key:"removeCells",value:function(){for(var e={},t=i.readUInt16();t--;)e.type=i.readUInt8(),e.id=i.readUInt32(),o.removeCell(e)}},{key:"addCells",value:function(){var e={},t=i.readUInt16();for(Logger.success("Cellszz received "+t);t--;)e.type=i.readUInt8(),e.id=i.readUInt32(),e.x=i.readInt16(),e.y=i.readInt16(),e.r=i.readUInt16(),e.color="",e.name="",1!==e.type&&4!==e.type||(e.color="rgb("+i.readUInt8()+", "+i.readUInt8()+", "+i.readUInt8()+")",1===e.type&&(e.name=i.readStringZeroUtf8())),o.addCell(e)}},{key:"updateCells",value:function(){for(var e={},t=i.readUInt16();t--;)e.type=i.readUInt8(),e.id=i.readUInt32(),e.x=i.readInt16(),e.y=i.readInt16(),e.r=i.readUInt16(),o.updateCell(e)}}]),n}(),r=function(){function i(){e(this,i)}return t(i,null,[{key:"connect",value:function(e){var t=this;this.connected&&this.disconnect(),this.ws=new WebSocket("ws://"+e),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){return t.onOpen()},this.ws.onclose=function(){return t.onClose()},this.ws.onmessage=function(e){return t.onMessage(e)},this.ws.onerror=function(){return t.onError()}}},{key:"disconnect",value:function(){this.ws.close(),this.ws={}}},{key:"send",value:function(e){!0===this.connected&&this.ws.send(e)}},{key:"onOpen",value:function(){this.connected=!0,u.handshake(),Logger.success("Connection established")}},{key:"onMessage",value:function(e){a.handle(e.data)}},{key:"onClose",value:function(){this.connected=!1,Logger.warn("Connection closed")}},{key:"onError",value:function(){this.connected=!1,Logger.error("Connection error")}}]),i}(),l=function(){function i(){e(this,i)}return t(i,null,[{key:"init",value:function(e){(!e||e<=0)&&(e=Buffer.poolSize/2),this._buffer=Buffer.allocUnsafe(e),this._length=0}},{key:"writeUInt8",value:function(e){this.checkAlloc(1),this._buffer[this._length++]=e}},{key:"writeInt8",value:function(e){this.checkAlloc(1),this._buffer[this._length++]=e}},{key:"writeUInt16",value:function(e){this.checkAlloc(2),this._buffer[this._length++]=e,this._buffer[this._length++]=e>>8}},{key:"writeInt16",value:function(e){this.checkAlloc(2),this._buffer[this._length++]=e,this._buffer[this._length++]=e>>8}},{key:"writeUInt32",value:function(e){this.checkAlloc(4),this._buffer[this._length++]=e,this._buffer[this._length++]=e>>8,this._buffer[this._length++]=e>>16,this._buffer[this._length++]=e>>24}},{key:"writeInt32",value:function(e){this.checkAlloc(4),this._buffer[this._length++]=e,this._buffer[this._length++]=e>>8,this._buffer[this._length++]=e>>16,this._buffer[this._length++]=e>>24}},{key:"writeFloat",value:function(e){this.checkAlloc(4),this._buffer.writeFloatLE(e,this._length,!0),this._length+=4}},{key:"writeDouble",value:function(e){this.checkAlloc(8),this._buffer.writeDoubleLE(e,this._length,!0),this._length+=8}},{key:"writeBytes",value:function(e){this.checkAlloc(e.length),e.copy(this._buffer,this._length,0,e.length),this._length+=e.length}},{key:"writeStringUtf8",value:function(e){var t=Buffer.byteLength(e,"utf8");this.checkAlloc(t),this._buffer.write(e,this._length,"utf8"),this._length+=t}},{key:"writeStringUnicode",value:function(e){var t=Buffer.byteLength(e,"ucs2");this.checkAlloc(t),this._buffer.write(e,this._length,"ucs2"),this._length+=t}},{key:"writeStringZeroUtf8",value:function(e){this.writeStringUtf8(e),this.writeUInt8(0)}},{key:"writeStringZeroUnicode",value:function(e){this.writeStringUnicode(e),this.writeUInt16(0)}},{key:"getLength",value:function(){return this._length}},{key:"reset",value:function(){this._length=0}},{key:"toBuffer",value:function(){return Buffer.concat([this._buffer.slice(0,this._length)])}},{key:"checkAlloc",value:function(e){var t=this._length+e;if(!(this._buffer.length>=t)){var i=Math.max(Buffer.poolSize/2,1024),n=t/i>>>0;t%i>0&&(n+=1);var s=Buffer.allocUnsafe(n*i);this._buffer.copy(s,0,0,this._length),this._buffer=s}}}]),i}(),u=function(){function i(){e(this,i)}return t(i,null,[{key:"emit",value:function(e){r.send(e)}},{key:"connect",value:function(e){r.connect(e),this.packets={handshake:0,spawn:10,splitCell:20,ejectMass:30,move:40}}},{key:"disconnect",value:function(){r.disconnect()}},{key:"handshake",value:function(){l.init(),l.writeUInt8(this.packets.handshake),l.writeUInt8(57),this.emit(l.toBuffer())}},{key:"spawn",value:function(e){l.init(),l.writeUInt8(this.packets.spawn),l.writeStringUtf8(e),this.emit(l.toBuffer())}},{key:"splitCell",value:function(){Logger.info("Split cell"),l.init(),l.writeUInt8(this.packets.splitCell),this.emit(l.toBuffer())}},{key:"ejectMass",value:function(){Logger.info("Eject"),l.init(),l.writeUInt8(this.packets.ejectMass),this.emit(l.toBuffer())}},{key:"move",value:function(e,t){l.init(),l.writeUInt8(this.packets.move),l.writeInt16(~~e),l.writeInt16(~~t),this.emit(l.toBuffer())}},{key:"eject",value:function(){l.init(),l.writeUInt8(this.packets.eject),this.emit(l.toBuffer())}},{key:"split",value:function(){l.init(),l.writeUInt8(this.packets.split),this.emit(l.toBuffer())}},{key:"spectate",value:function(){l.init(),l.writeUInt8(this.packets.spectate),this.emit(l.toBuffer())}}]),i}(),c=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.cells=[],this.cellIds=[],this.score=0,this.isAlive=!1,this.isSpawned=!1,this.isMoving=!0,$("#spawn").on("click",function(){e.isAlive||e.spawn($("#nickname").val())})}},{key:"connect",value:function(e){u.connect(e)}},{key:"flush",value:function(){this.create(),o.create()}},{key:"disconnect",value:function(){this.isAlive=!1,u.disconnect()}},{key:"spawn",value:function(e){this.isAlive=!0,$("#overlay").hide(),u.spawn(e)}},{key:"splitCell",value:function(){u.splitCell()}},{key:"ejectMass",value:function(){u.ejectMass()}},{key:"addCellId",value:function(e){this.cellIds.push(e)}}]),i}(),h=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.position={x:0,y:0,v:.1},this.animated={x:0,y:0,v:.1},this.zoomFactor=.9,$("#canvas").on("wheel",function(t){return e.zoom(t)})}},{key:"run",value:function(){this.animate(),this.move()}},{key:"animate",value:function(){this.animated.x=f.animate(this.animated.x,this.position.x,5),this.animated.y=f.animate(this.animated.y,this.position.y,5),this.animated.v=f.animate(this.animated.v,this.position.v,8)}},{key:"scale",value:function(){var e=f.canvas.width/2/this.animated.v-this.animated.x,t=f.canvas.height/2/this.animated.v-this.animated.y;f.ctx.scale(this.animated.v,this.animated.v),f.ctx.translate(~~e,~~t)}},{key:"zoom",value:function(e){e.originalEvent.wheelDelta<0?this.position.v*=this.zoomFactor:this.position.v/=this.zoomFactor,this.position.v<.02&&(this.position.v=.02),this.position.v>4/this.position.v&&(this.position.v=4/this.position.v)}},{key:"move",value:function(){var e=this.center();this.position.x=e.x,this.position.y=e.y}},{key:"center",value:function(){var e={x:0,y:0},t={x:0,y:0},i=0;return c.cells.forEach(function(e){t.x=t.x+c.cells[e.id].position.x,t.y=t.y+c.cells[e.id].position.y,i++}),c.isSpawned&&0===i&&(c.isSpawned=!1,c.isAlive=!1,$("#overlay").toggle()),i>0&&(e={x:t.x/i,y:t.y/i}),e}}]),i}(),f=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.canvas=$("#canvas")[0],this.ctx=this.canvas.getContext("2d"),this.pi2=2*Math.PI,this.leaderboard=$("#lbPos"),this.borderColor="#F44336",this.foodColor="#03A9F4",this.virusColor="#555",this.virusStroke="#24815d",this.fps={now:0,filter:50,lastUpdate:1*new Date,value:0,display:0},this.resize(),window.onresize=function(){return e.resize()}}},{key:"run",value:function(){this.refresh(),this.draw(),this.restore(),this.calcFps()}},{key:"refresh",value:function(){this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),h.scale()}},{key:"draw",value:function(){this.grid(),this.border(),this.food(),this.cells()}},{key:"restore",value:function(){this.ctx.restore()}},{key:"resize",value:function(){this.canvas.width=~~window.innerWidth,this.canvas.height=~~window.innerHeight}},{key:"border",value:function(){var e=this.ctx;e.strokeStyle=this.borderColor,e.lineWidth=200,e.strokeRect(o.border.left-100,o.border.top-100,14342,14342)}},{key:"grid",value:function(){var e=this.ctx,t=o.border.left,i=o.border.top,n=o.border.right,s=o.border.bottom,a=["A","B","C","D","E"],r=void 0,l=void 0,u=void 0,c=void 0;for(e.textAlign="center",e.textBaseline="middle",e.beginPath(),r=0;r<6;r++)u=t+2828*r,c=i+2828*r,e.moveTo(u,i),e.lineTo(u,s),e.moveTo(t,c),e.lineTo(n,c);for(e.closePath(),e.lineWidth=150,e.strokeStyle="#161616",e.stroke(),e.font="1600px ubuntu",e.fillStyle="#161616",l=0;l<5;l++)for(r=0;r<5;r++)u=t+1414+2828*r,c=i+1414+2828*l,e.fillText(a[l]+(r+1),u,c)}},{key:"cells",value:function(){var e=this,t=this.ctx;o.cells.forEach(function(i){if(i.animated.x=e.animate(i.animated.x,i.position.x,6),i.animated.y=e.animate(i.animated.y,i.position.y,6),i.animated.r=e.animate(i.animated.r,i.position.r,7),t.beginPath(),t.arc(i.animated.x,i.animated.y,i.animated.r,0,e.pi2,!1),t.closePath(),2===i.type&&(t.fillStyle=e.virusColor,t.globalAlpha=.7,t.fill(),t.globalAlpha=1,t.lineWidth=10,t.strokeStyle=e.virusStroke,t.stroke()),4===i.type&&(t.fillStyle="#24815d",t.fill()),1===i.type){var s=~~i.animated.y;t.lineWidth=0,t.fillStyle=i.color,t.fill();var o=i.nameCache;o.setValue(i.name),o.setSize(i.getNameSize()/1.2);var a=Math.ceil(10*h.animated.v)/10;o.setScale(a);var r=o.render(),l=~~(r.width/a),u=~~(r.height/a);t.drawImage(r,~~i.animated.x-~~(l/2),s-~~(u/2),l,u),s+=r.height/2/a+4,null==i.sizeCache&&(i.sizeCache=new n(i.getNameSize()/2,"#FFFFFF",!0,"#000000"));var c=i.sizeCache;c.setSize(i.getNameSize()/2),c.setValue(~~(i.animated.r*i.animated.r/100));var f=Math.ceil(10*h.animated.v)/10;c.setScale(f);var d=c.render(),v=~~(d.width/f),y=~~(d.height/f);t.drawImage(d,~~i.animated.x-~~(v/2),s-~~(y/2),v,y)}})}},{key:"food",value:function(){var e=this,t=this.ctx;t.beginPath(),o.food.forEach(function(i){t.moveTo(i.position.x+i.position.r+4,i.position.y),t.arc(i.position.x,i.position.y,i.position.r+4,0,e.pi2,!1)}),t.closePath(),t.fillStyle=this.foodColor,t.fill()}},{key:"animate",value:function(e,t,i){return e+(t-e)/i}},{key:"calcFps",value:function(){var e=1e3/((this.fps.now=Date.now())-this.fps.lastUpdate);this.fps.now!==this.fps.lastUpdate&&($("#fps").text(~~this.fps.value),this.fps.value+=(e-this.fps.value)/this.fps.filter,this.fps.lastUpdate=this.fps.now)}}]),i}(),d=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.pressed=!1,$(document).on("keydown",function(t){return e.keydown(t)}),$(document).on("keyup",function(t){return e.keyup(t)})}},{key:"keydown",value:function(e){if(!$(e.target).is("input, textarea, select")&&!this.pressed)switch(this.pressed=!0,e.keyCode){case keycode("w"):this.eject();break;case keycode("a"):this.multiSplit();break;case keycode("s"):this.freeze();break;case keycode("d"):this.doubleSplit();break;case keycode("space"):this.split();break;case keycode("escape"):this.overlay()}}},{key:"keyup",value:function(e){this.pressed=!1}},{key:"overlay",value:function(){$("#overlay").toggle()}},{key:"freeze",value:function(){c.isMoving=!c.isMoving}},{key:"split",value:function(){c.splitCell()}},{key:"doubleSplit",value:function(){c.splitCell(),setTimeout(function(){return c.splitCell()},100)}},{key:"multiSplit",value:function(){c.splitCell(),setTimeout(function(){return c.splitCell()},50),setTimeout(function(){return c.splitCell()},100),setTimeout(function(){return c.splitCell()},150)}},{key:"eject",value:function(){var e=this;this.pressed&&(c.ejectMass(),setTimeout(function(){return e.eject()},150))}}]),i}(),v=function(){function i(){e(this,i)}return t(i,null,[{key:"init",value:function(){var e=this;if($.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_US/sdk.js",function(){FB.init({appId:"102251620343810",version:"v2.9"}),$("#facebook").removeAttr("disabled")}),localStorage.token&&""!==localStorage.token){var t=jwtDecode(localStorage.token);if(t.exp<+new Date/1e3)$(".login").animateCss("zoomInUp"),$(".login").show(),$(".profile").hide();else if(""===t.user_name)$(".username").animateCss("zoomInUp"),$(".username").show(),$(".login").hide(),$(".profile").hide();else{var i=JSON.parse(localStorage.user);$(".login").hide(),$(".profile").animateCss("zoomInUp"),$(".profile").show(),$(".user").text(i.username+"#"+i.user_id),$(".email").text(""+i.email)}}else $(".login").animateCss("zoomInUp"),$(".login").show(),$(".profile").hide();$("#facebook").on("click",function(){return e.fbLogin()}),$("#logout").on("click",function(){return e.logout()}),$("#continue").on("click",function(){return e.username()})}},{key:"logout",value:function(){localStorage.token="",localStorage.user="",$(".profile").hide(),$(".login").animateCss("zoomInUp"),$(".login").show()}},{key:"username",value:function(){$("#username").val().length>3&&$.post("http://localhost:4000/username",{token:localStorage.token,username:$("#username").val()}).done(function(e){localStorage.token=e.token,localStorage.user=JSON.stringify(e.user),$(".user").text(e.user.username+"#"+e.user.id),$(".email").text(""+e.user.email),$(".username").hide(),$(".profile").animateCss("zoomInUp"),$(".profile").show()})}},{key:"fbLogin",value:function(){return FB.login(function(e){if(e.authResponse){var t=e.authResponse.accessToken;$.post("http://localhost:4000/auth/facebook",{access_token:t}).done(function(e){if(!1===e.emailValid)return bootbox.alert("Cell Wars requires the Facebook email permission to be allowed. Please try again."),void $(".modal-content").animateCss("zoomInDown");localStorage.setItem("token",e.token),""===jwtDecode(e.token).user_name?($(".username").animateCss("zoomInUp"),$(".username").show(),$(".username").focus(),$(".login").hide(),$(".profile").hide()):(localStorage.setItem("user",JSON.stringify(e.user)),$(".user").text(e.user.username+"#"+e.user.user_id),$(".email").text(""+e.user.email),$(".login").hide(),$(".profile").animateCss("zoomInUp"),$(".profile").show(),Logger.info("User logged in with Facebook"))})}else Logger.warn("User failed to authorize with Facebook")},{scope:"email",auth_type:"rerequest"}),!1}}]),i}(),y=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.x=0,this.y=0,$("#canvas").on("mousemove",function(t){return e.coords(t)})}},{key:"run",value:function(){var e=this.relative();u.move(~~e.x,~~e.y)}},{key:"coords",value:function(e){this.x=e.clientX,this.y=e.clientY}},{key:"relative",value:function(){var e={x:0,y:0};return c.isMoving?(e.x=h.position.x+(this.x-f.canvas.width/2)/h.position.v,e.y=h.position.y+(this.y-f.canvas.height/2)/h.position.v):(e.x=h.position.x,e.y=h.position.y),e}}]),i}(),k=function(){function i(){e(this,i)}return t(i,null,[{key:"start",value:function(){var e=this;v.init(),c.create(),o.create(),h.create(),f.create(),y.create(),d.create(),setInterval(function(){return e.mouseLoop()},33),this.gameLoop(),Logger.info("Engine started")}},{key:"gameLoop",value:function(){var e=this;c.isAlive&&(f.run(),h.run()),requestAnimationFrame(function(){return e.gameLoop()})}},{key:"mouseLoop",value:function(){c.isAlive&&y.run()}}]),i}(),p=function(){function i(t,n,s,o,a,r,l){e(this,i),this.id=t,this.position={x:n,y:s,r:o},this.animated={x:n,y:s,r:o},this.color=a,this.name=r,this.type=l,this.nameCache=null,this.sizeCache=null,this.setNameCache(r)}return t(i,[{key:"getNameSize",value:function(){return Math.max(~~(.3*this.animated.r),24)}},{key:"setNameCache",value:function(e){null===this.nameCache?(this.nameCache=new n(this.getNameSize(),"#FFFFFF",!0,"#000000"),this.nameCache.setValue(this.name)):(this.nameCache.setSize(this.getNameSize()),this.nameCache.setValue(this.name))}}]),i}(),m=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){this.cells=[],this.food=[],this.border={top:-7071,bottom:7071,left:-7071,right:7071}}},{key:"addCell",value:function(e){var t=new p(e.id,e.x,e.y,e.r,e.color,e.name,e.type);3!==e.type?this.cells[e.id]=t:this.food[e.id]=t,1===e.type&&g.cellIds.indexOf(e.id)>-1&&(g.cells[e.id]=t,g.isSpawned=!0)}},{key:"removeCell",value:function(e){3!==e.type?(e.id in this.cells&&(this.cells[e.id]=null,delete this.cells[e.id]),e.id in g.cells&&(g.cells[e.id]=null,delete g.cells[e.id])):(this.food[e.id]=null,delete this.food[e.id])}},{key:"updateCell",value:function(e){3!==e.type?e.id in this.cells&&(this.cells[e.id].position.x=e.x,this.cells[e.id].position.y=e.y,this.cells[e.id].position.r!==e.r&&(this.cells[e.id].position.r=e.r,this.sortCells())):(this.food[e.id].position.x=e.x,this.food[e.id].position.y=e.y)}},{key:"sortCells",value:function(){}}]),i}(),g=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(){var e=this;this.cells=[],this.cellIds=[],this.score=0,this.isAlive=!1,this.isSpawned=!1,this.isMoving=!0,$("#spawn").on("click",function(){e.isAlive||e.spawn($("#nickname").val())})}},{key:"connect",value:function(e){u.connect(e)}},{key:"flush",value:function(){this.create(),m.create()}},{key:"disconnect",value:function(){this.isAlive=!1,u.disconnect()}},{key:"spawn",value:function(e){this.isAlive=!0,$("#overlay").hide(),u.spawn(e)}},{key:"splitCell",value:function(){u.splitCell()}},{key:"ejectMass",value:function(){u.ejectMass()}},{key:"addCellId",value:function(e){this.cellIds.push(e)}}]),i}();window.Buffer=buffer.Buffer,$.fn.extend({animateCss:function(e){this.addClass("animated "+e).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+e)})}}),$(".play").animateCss("zoomInUp"),$("body").on("shown.bs.modal",".modal",function(){$(this).css({top:"50%","margin-top":function(){return-$(this).height()/2}})}),bootbox.setDefaults({animate:!1}),$("#asia i").hide(),$("#americas i").hide(),g.connect("140.113.92.237:50001"),$("#europe").on("click",function(){$("#asia i").hide(),$("#americas i").hide(),$("#europe i").show(),$("#europe i").animateCss("jello"),g.flush(),g.connect("140.113.92.237:50001")}),$("#asia").on("click",function(){$("#europe i").hide(),$("#americas i").hide(),$("#asia i").show(),$("#asia i").animateCss("jello"),g.flush(),g.connect("140.113.92.237:50000")}),$("#americas").on("click",function(){$("#europe i").hide(),$("#asia i").hide(),$("#americas i").show(),$("#americas i").animateCss("jello"),g.connect("140.113.92.237:50002")}),$("button").on("mouseover",function(){var e=$(this).css("background-color");$(this).css("background",color.rgb($(this).css("background-color")).darken(.25)),$(this).on("mouseout",function(){$(this).css("background",e)})}),$("input").on("focusin",function(){var e=$(this).css("background-color");$(this).css("background",color.rgb($(this).css("background-color")).darken(.15)),$(this).on("focusout",function(){$(this).css("background",e)})}),k.start()}();
//# sourceMappingURL=main.js.map
